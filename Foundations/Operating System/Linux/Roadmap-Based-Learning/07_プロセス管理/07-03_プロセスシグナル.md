# Linux プロセスシグナル講座

## 概要と重要性
プロセスシグナルはLinuxにおけるプロセス間通信の基本的な仕組みであり、実行中のプロセスに様々な指示を送るために不可欠です。

## 主要概念
シグナルはプロセスに送信される非同期通知であり、プロセスの実行を中断、一時停止、または終了させることができます。

## 実践コマンド例

### 1. プロセスを起動してPIDを確認する

まずは、バックグラウンドでスリープするプロセスを作成しましょう。

```bash
sleep 300 &
```

このコマンドを入力して実行してみましょう。実行すると、以下のような出力が表示されます：

```
[1] 12345
```

表示される数字は実際のプロセスID（PID）で、環境によって異なります。このPIDを使って以降の操作を行います。

### 2. 実行中のプロセスに関する情報を確認する

起動したプロセスの情報を確認しましょう。

```bash
ps aux | grep sleep
```

このコマンドを入力して実行してみましょう。以下のような出力が表示されます：

```
username  12345  0.0  0.0   8168   528 pts/0    S    10:15   0:00 sleep 300
```

この出力では、ユーザー名、PID、CPU使用率、メモリ使用率、コマンド名などが確認できます。

### 3. SIGSTOP シグナルでプロセスを一時停止する

プロセスに一時停止の指示を送ります。

```bash
kill -SIGSTOP 12345
```

このコマンドを入力して実行してみましょう（12345は実際のPIDに置き換えてください）。
実行しても特に出力はありませんが、プロセスが一時停止します。

プロセスの状態を確認してみましょう：

```bash
ps aux | grep sleep
```

出力は以下のようになります：

```
username  12345  0.0  0.0   8168   528 pts/0    T    10:15   0:00 sleep 300
```

ステータスが「T」（停止中）になっていることが確認できます。

### 4. SIGCONT シグナルでプロセスを再開する

一時停止したプロセスを再開します。

```bash
kill -SIGCONT 12345
```

このコマンドを入力して実行してみましょう（12345は実際のPIDに置き換えてください）。
再びプロセスの状態を確認すると：

```bash
ps aux | grep sleep
```

出力は以下のようになります：

```
username  12345  0.0  0.0   8168   528 pts/0    S    10:15   0:00 sleep 300
```

ステータスが「S」（スリープ中）に戻り、プロセスが再開されたことが確認できます。

### 5. SIGTERM シグナルでプロセスを終了する

プロセスに終了の指示を送ります。

```bash
kill -SIGTERM 12345
```

このコマンドを入力して実行してみましょう（12345は実際のPIDに置き換えてください）。
SIGTERM は「正常終了してください」という指示を送ります。プロセスはリソースを適切に解放して終了します。

プロセスの状態を確認してみましょう：

```bash
ps aux | grep sleep
```

該当するプロセスが表示されなくなっていれば、正常に終了しています。

### 6. SIGKILL シグナルで強制終了する

別のプロセスを起動して、強制終了を試してみましょう。

```bash
sleep 300 &
```

実行後に表示されたPIDを使って：

```bash
kill -SIGKILL 12346
```

このコマンドを入力して実行してみましょう（12346は実際のPIDに置き換えてください）。
SIGKILL は「即座に強制終了」を意味し、プロセスはリソースの解放などを行わずに強制的に終了します。

プロセスの状態を確認すると、即座に消えていることが分かります：

```bash
ps aux | grep sleep
```

### 7. シグナルの種類と番号を確認する

シグナルには番号も割り当てられています。どのような種類があるか確認してみましょう。

```bash
kill -l
```

このコマンドを入力して実行してみましょう。以下のような出力が表示されます：

```
 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP
 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1
11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM
16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP
21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR
31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX
```

シグナル名と対応する番号が表示されます。例えば、SIGKILL は 9 番、SIGTERM は 15 番です。

### 8. 番号でシグナルを送信する

シグナル名の代わりに番号を使ってシグナルを送信することもできます。

```bash
sleep 300 &
```

新しいPIDを使って：

```bash
kill -9 12347
```

このコマンドを入力して実行してみましょう（12347は実際のPIDに置き換えてください）。
これは `kill -SIGKILL 12347` と同じ効果があります。

### 9. 実行中のコマンドをCtrl+Cで中断する

ターミナルで実行しているコマンドは、Ctrl+Cキーを押すことで中断できます。これは内部的にはSIGINT（割り込み）シグナルを送信しています。

```bash
sleep 10
```

このコマンドを実行して、すぐにCtrl+Cキーを押してみましょう。以下のように表示されて終了します：

```
^C
```

### 10. プロセスグループ全体にシグナルを送る

プロセスグループ全体にシグナルを送信することもできます。PIDの前にマイナス記号をつけます。

```bash
sleep 300 &
sleep 300 &
```

親プロセスのPIDを確認し：

```bash
ps j | grep sleep
```

出力例：

```
 1234  5678  5678  5678 pts/0     5679 S        1000   0:00 sleep 300
 1234  5678  5678  5678 pts/0     5680 S        1000   0:00 sleep 300
```

プロセスグループIDを使ってグループ全体を終了：

```bash
kill -TERM -5678
```

このコマンドを入力して実行してみましょう（5678は実際のプロセスグループIDに置き換えてください）。
これにより、同じプロセスグループのすべてのプロセスが終了します。
