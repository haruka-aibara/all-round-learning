# 【Linux講座】uniq

## 概要
uniqコマンドは隣接する重複行を検出・削除するためのテキスト処理ツールで、データの整理や解析に非常に役立ちます。

## 主要概念
uniqは標準入力または指定されたファイルから隣接する重複行を処理し、通常はsortコマンドと組み合わせて使用します。

## 実践コマンド例

### 1. サンプルデータの作成

まずは実験用のデータファイルを作成しましょう。

```bash
cat > sample.txt << 'EOF'
apple
banana
apple
orange
orange
banana
grape
apple
EOF
```

このコマンドを入力して実行してみましょう。`sample.txt`というファイルが作成され、複数の果物名が記載されます。

### 2. 基本的なuniqの使用法

```bash
uniq sample.txt
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
apple
banana
apple
orange
banana
grape
apple
```

注目すべき点：隣接している重複行（`orange`）のみが削除されています。`apple`や`banana`は隣接していないため、重複していても削除されていません。

### 3. sortと組み合わせたuniqの使用

```bash
sort sample.txt | uniq
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
apple
banana
grape
orange
```

解説：`sort`コマンドで行を並べ替えてから`uniq`に渡すことで、すべての重複を効果的に除去できます。

### 4. 重複行のみを表示

```bash
sort sample.txt | uniq -d
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
apple
banana
orange
```

解説：`-d`オプションを使うと、ファイル内で重複している行のみを表示します。出力には、重複している各行が1回だけ表示されます。

### 5. 重複していない行のみを表示

```bash
sort sample.txt | uniq -u
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
grape
```

解説：`-u`オプションを使うと、ファイル内で一度だけ出現する行のみが表示されます。この例では「grape」だけが一度しか出現していないので、これだけが表示されます。

### 6. 各行の出現回数をカウント

```bash
sort sample.txt | uniq -c
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
      3 apple
      2 banana
      1 grape
      2 orange
```

解説：`-c`オプションを使うと、各行の前にその行の出現回数が表示されます。これはデータ分析やログファイルの処理に非常に便利です。

### 7. 比較する文字数を指定

新しいサンプルファイルを作成しましょう：

```bash
cat > prefixes.txt << 'EOF'
prefix123
prefix456
different789
EOF
```

このコマンドを入力して実行してみましょう。

次に、先頭の6文字だけを比較してuniqを適用します：

```bash
uniq -w 6 prefixes.txt
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
prefix123
different789
```

解説：`-w 6`オプションは比較する文字数を最初の6文字に制限します。「prefix123」と「prefix456」は最初の6文字（「prefix」）が同じなので、「prefix456」は重複として除外されました。

### 8. 大文字小文字を区別せずに比較

新しいサンプルファイルを作成しましょう：

```bash
cat > case.txt << 'EOF'
Apple
apple
BANANA
banana
EOF
```

このコマンドを入力して実行してみましょう。

大文字小文字を区別せずに重複を削除します：

```bash
uniq -i case.txt
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
Apple
BANANA
```

解説：`-i`オプションを使うと、大文字小文字を区別せずに比較します。そのため「Apple」と「apple」は同じとみなされ、2つ目の「apple」は削除されます。同様に「BANANA」と「banana」も同じとみなされます。

### 9. 連続する重複行を特定の回数だけ保持

```bash
cat > repeats.txt << 'EOF'
line1
line1
line1
line2
line2
line3
EOF

uniq -f 2 repeats.txt
```

このコマンドを入力して実行してみましょう。結果は以下のようになります：

```
line1
line1
line2
line3
```

解説：`-f 2`オプションは、連続する重複行のうち最初の2行だけを保持し、それ以降の重複を削除します。この例では「line1」が3回連続していますが、最初の2回だけが保持されています。

以上がuniqコマンドの基本的な使い方です。実際のデータ処理では、特にsortと組み合わせることで強力なテキスト処理が可能になります。
