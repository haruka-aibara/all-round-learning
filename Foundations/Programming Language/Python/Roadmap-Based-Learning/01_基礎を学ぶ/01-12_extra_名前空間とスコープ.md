# 名前空間とスコープ

## 概要
名前空間とスコープはPythonの変数管理の仕組みであり、変数の有効範囲と可視性を制御する重要な概念です。

## 主要概念
Pythonでは名前空間によって変数名が管理され、スコープによって変数の参照可能な範囲が決定されます。

## 実践的なコード例

### グローバル変数へのアクセス

以下のコードを入力して実行してみましょう：

```python
animal = 'cat'  # グローバル変数の定義

print(animal)  # グローバル変数の表示

def f():
    print(animal)  # 関数内からグローバル変数にアクセス

# グローバル変数なので、関数内で取得できる
f()
```

**実行結果:**
```
cat
cat
```

**解説:** 
グローバル変数`animal`は関数の外で定義されているため、関数`f()`の中からでも参照できます。関数内から関数外の変数にアクセスできるのは、Pythonのスコープの仕組みによるものです。

### ローカル変数とグローバル変数の衝突

以下のコードはエラーになります：

```python
animal = 'cat'
# これはエラーが出ます
def f():
    print(animal)  # この時点ではanimalはまだローカル変数として認識されていない
    animal = "dog"  # ここでanimalがローカル変数として定義される
    print('after', animal)
f()
```

**解説:**
このコードを実行すると`UnboundLocalError`が発生します。関数内で`animal`に値を代入しているため、Pythonはその変数をローカル変数として扱います。しかし、最初の`print(animal)`の時点ではまだ値が代入されていないため、エラーになります。

### ローカル変数の使用

以下のコードを入力して実行してみましょう：

```python
def f():
    # print(animal)  # この行はコメントアウトされている
    animal = "dog"  # ローカル変数animalを定義
    print('after', animal)

f()
```

**実行結果:**
```
after dog
```

**解説:**
このコードでは関数内で`animal`変数を新たに定義しています。この`animal`はローカル変数であり、関数内でのみ有効です。

### グローバル変数の変更

以下のコードを入力して実行してみましょう：

```python
# 関数内でグローバル変数を書き換えたいときは
def f():
    global animal  # animalがグローバル変数であることを宣言
    animal = "dog"  # グローバル変数animalの値を変更
    print(animal)

f()
print(animal)  # 関数外からグローバル変数を表示
```

**実行結果:**
```
dog
dog
```

**解説:**
`global`キーワードを使うことで、関数内からグローバル変数を変更することができます。関数実行後もグローバル変数の値が変更されたままになります。

### locals()とglobals()関数

以下のコードを入力して実行してみましょう：

```python
# ローカル変数を表示
animal = 'cat'

def f():
    animal = "dog"  # ローカル変数animalを定義
    print('local:', locals())  # ローカル名前空間を表示

f()
print('global:', animal)  # グローバル変数の値を確認

# グローバル変数を表示
print('global vars:', globals())  # グローバル名前空間を表示
```

**実行結果:**
```
local: {'animal': 'dog'}
global: cat
global vars: {...多数の項目...}
```

**解説:**
- `locals()`はローカル名前空間の辞書を返します。関数内では、ローカル変数`animal`の値が`"dog"`であることがわかります。
- `globals()`はグローバル名前空間の辞書を返します。これには多くの組み込み変数やモジュールも含まれています。
- 関数内のローカル変数`animal`とグローバル変数`animal`は別の名前空間に存在するため、互いに干渉しません。
