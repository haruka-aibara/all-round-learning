# 【Linux講座】シンボリックリンクとハードリンク

## 概要
Linuxにおけるシンボリックリンクとハードリンクはファイルシステム内でショートカットや複製効果を作成できる参照機能です。

## 理論的説明
ハードリンクは元ファイルと同じinodeを共有する完全な複製であり、シンボリックリンクは別のinodeを持つ元ファイルへの「ポインタ」です。

## 実践編: コマンド例とその解説

### 準備：テスト用ファイルの作成

まずは実験用のファイルを作成しましょう。

```bash
echo "これはテスト用のファイルです。" > source_file.txt
```

このコマンドを入力して実行してみましょう。「source_file.txt」というファイルが作成され、中に「これはテスト用のファイルです。」というテキストが書き込まれます。

### ハードリンクの作成

次にハードリンクを作成します。

```bash
ln source_file.txt hard_link.txt
```

このコマンドを入力して実行してみましょう。「hard_link.txt」というハードリンクが作成されます。見た目は普通のファイルと同じですが、実体は「source_file.txt」と同一です。

### シンボリックリンク（ソフトリンク）の作成

続いてシンボリックリンクを作成します。

```bash
ln -s source_file.txt soft_link.txt
```

このコマンドを入力して実行してみましょう。`-s`オプションを使うことでシンボリックリンクが作成されます。「soft_link.txt」というシンボリックリンクが作成されます。

### リンクの確認

作成したリンクを確認してみましょう。

```bash
ls -li
```

このコマンドを入力して実行してみましょう。`-li`オプションを使うことで、ファイルのinode番号も含めて表示されます。実行結果は以下のようになります：

```
1234567 -rw-r--r-- 2 user group 30 4月 20 10:00 hard_link.txt
1234567 -rw-r--r-- 2 user group 30 4月 20 10:00 source_file.txt
1234568 lrwxrwxrwx 1 user group 13 4月 20 10:00 soft_link.txt -> source_file.txt
```

注目すべき点：
- ハードリンク（hard_link.txt）と元ファイル（source_file.txt）は同じinode番号（この例では1234567）を持っています
- シンボリックリンク（soft_link.txt）は異なるinode番号（1234568）を持ち、「-> source_file.txt」と表示されています
- ハードリンクのリンク数（2つ目の数字）は2になっています（元ファイルとハードリンクの2つ）

### ファイルの内容確認

各ファイルの内容を確認してみましょう。

```bash
cat source_file.txt
cat hard_link.txt
cat soft_link.txt
```

これらのコマンドを順に入力して実行してみましょう。全て同じ「これはテスト用のファイルです。」という内容が表示されます。

### 元ファイルの内容変更

元ファイルの内容を変更してみましょう。

```bash
echo "内容を変更しました。" > source_file.txt
```

このコマンドを入力して実行してみましょう。元ファイルの内容が「内容を変更しました。」に変わります。

### 変更後の内容確認

各ファイルの内容を再確認してみましょう。

```bash
cat source_file.txt
cat hard_link.txt
cat soft_link.txt
```

これらのコマンドを順に入力して実行してみましょう。全て同じ「内容を変更しました。」という内容が表示されます。ハードリンクもシンボリックリンクも元ファイルの変更が反映されています。

### 元ファイルの削除

元ファイルを削除してみましょう。

```bash
rm source_file.txt
```

このコマンドを入力して実行してみましょう。元ファイル「source_file.txt」が削除されます。

### 元ファイル削除後のリンク動作確認

元ファイルを削除した後、各リンクの動作を確認してみましょう。

```bash
cat hard_link.txt
cat soft_link.txt
```

これらのコマンドを順に入力して実行してみましょう。結果は以下のようになります：

- `cat hard_link.txt` → 「内容を変更しました。」と表示されます。ハードリンクは元ファイルと同じinodeを共有しているため、元ファイルが削除されてもデータは残っています。
- `cat soft_link.txt` → 「soft_link.txt: そのようなファイルやディレクトリはありません」などのエラーが表示されます。シンボリックリンクは元ファイルへの参照のみなので、元ファイルが削除されるとリンクが切れてしまいます。

### 別のディレクトリへのリンク作成

ディレクトリを作成し、そこへのリンクを試してみましょう。

```bash
mkdir test_dir
echo "ディレクトリ内のファイルです" > test_dir/dir_file.txt
```

これらのコマンドを入力して実行してみましょう。「test_dir」というディレクトリと、その中に「dir_file.txt」というファイルが作成されます。

```bash
ln -s test_dir dir_symlink
```

このコマンドを入力して実行してみましょう。ディレクトリへのシンボリックリンク「dir_symlink」が作成されます。

```bash
ls -l dir_symlink
```

このコマンドを入力して実行してみましょう。「dir_symlink」の内容（つまり「test_dir」の内容）が表示されます。

```bash
cat dir_symlink/dir_file.txt
```

このコマンドを入力して実行してみましょう。シンボリックリンク経由でディレクトリ内のファイルにアクセスできます。「ディレクトリ内のファイルです」と表示されます。

## まとめ

- **ハードリンク**：元ファイルと同じinodeを共有し、データも共有。元ファイルが削除されても存続する。
- **シンボリックリンク**：元ファイルへの参照のみ。異なるinodeを持ち、元ファイルが削除されるとリンクが切れる。ディレクトリにも作成できる。
