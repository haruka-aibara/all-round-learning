# Linuxにおけるメモリとディスク使用状況の監視

## 概要
システムのメモリとディスク使用状況を監視することは、Linuxサーバーの安定稼働と最適なパフォーマンスを維持するために重要です。

## 主要概念
Linuxシステムでは、メモリ使用状況は物理メモリ(RAM)、スワップ、キャッシュに分けられ、各種コマンドを使って詳細に把握できます。

## メモリ使用状況の確認

### 1. `free`コマンドでメモリ概要を確認

このコマンドを入力して実行してみましょう：
```bash
free -h
```

期待される出力例：
```
              total        used        free      shared  buff/cache   available
Mem:           15Gi       10Gi       256Mi       690Mi       5.3Gi       4.2Gi
Swap:         8.0Gi       1.3Gi       6.7Gi
```

**解説**：
- `-h` オプションは「human-readable」の意味で、読みやすい単位（GB、MB）で表示します
- `total`：システムの総メモリ量
- `used`：使用中のメモリ量
- `free`：完全に空いているメモリ量
- `shared`：複数のプロセスで共有されているメモリ量
- `buff/cache`：ファイルシステムのバッファとキャッシュに使われているメモリ量
- `available`：新しいプロセスが使用できる見込みのメモリ量（解放可能なキャッシュを含む）

### 2. `vmstat`コマンドでメモリ状態の詳細を確認

このコマンドを入力して実行してみましょう：
```bash
vmstat 1 5
```

期待される出力例：
```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0 1331712 262144 198668 5505292    0    0     6    17   41   62  2  1 97  0  0
 0  0 1331712 261884 198668 5505292    0    0     0     0  249  489  1  0 99  0  0
 0  0 1331712 261884 198668 5505292    0    0     0     0  236  458  0  1 99  0  0
 0  0 1331712 261884 198668 5505292    0    0     0     0  256  498  1  0 99  0  0
 0  0 1331712 261884 198668 5505292    0    0     0    36  245  476  0  1 99  0  0
```

**解説**：
- `1 5` は1秒ごとに5回情報を表示することを意味します
- `swpd`：使用されているスワップメモリの量
- `free`：空きメモリ量
- `buff`：バッファとして使われているメモリ量
- `cache`：キャッシュとして使われているメモリ量
- `si/so`：スワップインとスワップアウトの量（KB/秒）
- 高い`si`値はメモリ不足を示す可能性があります

### 3. `top`コマンドでリアルタイムのメモリ使用状況を確認

このコマンドを入力して実行してみましょう：
```bash
top
```

期待される出力例：
```
top - 14:28:41 up 1 day,  5:55,  1 user,  load average: 0.00, 0.01, 0.05
Tasks: 213 total,   1 running, 212 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :  15934.7 total,    256.0 free,  10240.0 used,   5438.7 buff/cache
MiB Swap:   8192.0 total,   6860.8 free,   1331.2 used.   4337.9 avail Mem 

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
   1828 root      20   0  398596  58520  27524 S   0.3   0.4   0:32.73 Xorg
   2201 user1     20   0 5235940 334444 112600 S   0.3   2.0   2:21.41 gnome-shell
```

**解説**：
- 上部にシステム全体のメモリ使用状況が表示されます
- 下部に各プロセスごとのメモリ使用状況が表示されます
- `q`キーを押すと終了します
- `VIRT`：プロセスが利用可能な仮想メモリ量
- `RES`：物理メモリ上で実際に使用している量
- `SHR`：他のプロセスと共有可能なメモリ量
- `%MEM`：使用中の物理メモリの割合

## ディスク使用状況の確認

### 1. `df`コマンドでファイルシステムの使用状況を確認

このコマンドを入力して実行してみましょう：
```bash
df -h
```

期待される出力例：
```
Filesystem      Size  Used Avail Use% Mounted on
udev            7.8G     0  7.8G   0% /dev
tmpfs           1.6G  1.7M  1.6G   1% /run
/dev/sda1       457G  163G  271G  38% /
tmpfs           7.8G  112M  7.7G   2% /dev/shm
tmpfs           5.0M  4.0K  5.0M   1% /run/lock
```

**解説**：
- `-h`オプションは人間が読みやすいサイズ表示（GB、MB）を意味します
- `Size`：ファイルシステムの全体サイズ
- `Used`：使用済みの容量
- `Avail`：利用可能な容量
- `Use%`：使用率のパーセンテージ
- `Mounted on`：マウントポイント

### 2. `du`コマンドで特定ディレクトリの使用量を確認

このコマンドを入力して実行してみましょう：
```bash
du -sh /home/user
```

期待される出力例：
```
4.2G    /home/user
```

**解説**：
- `-s`はサマリー表示（ディレクトリ全体の合計）を意味します
- `-h`は人間が読みやすい形式（GB、MB）での表示を意味します
- 特定のユーザーのホームディレクトリがどれだけの容量を使用しているかが分かります

### 3. `du`コマンドでディレクトリ内の大きなファイルを特定

このコマンドを入力して実行してみましょう：
```bash
du -h --max-depth=1 /var | sort -hr
```

期待される出力例：
```
8.4G    /var
4.2G    /var/log
2.1G    /var/lib
1.3G    /var/cache
422M    /var/tmp
2.4M    /var/backups
52K     /var/spool
```

**解説**：
- `-h`は人間が読みやすい形式での表示を意味します
- `--max-depth=1`はサブディレクトリ1階層目までの情報のみ表示します
- `sort -hr`は数値の大きい順（降順）に並べ替えます
- ディスク容量を多く使用しているディレクトリを素早く特定できます
