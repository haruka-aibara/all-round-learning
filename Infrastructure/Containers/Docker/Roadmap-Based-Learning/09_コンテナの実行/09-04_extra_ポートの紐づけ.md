# Dockerポートの紐づけの使い分け

## 概要
Dockerコンテナとホストマシンの間のポート紐づけは、コンテナ化されたアプリケーションを外部から利用可能にするための重要な設定です。

## 理論的説明
Dockerコンテナは独自のネットワーク空間を持ち、ポートのマッピングによってホストマシンとコンテナ間の通信経路を確立します。

## docker container run -p オプションの使い方

### 基本形式
```
docker container run -p [ホストポート]:[コンテナポート] [イメージ名]
```

### 主な使い分けパターン

#### 1. 特定のホストポートとコンテナポートのマッピング
```
docker container run -p 8080:80 nginx
```
- **意味**: ホストの8080ポートへのアクセスをコンテナの80ポートに転送
- **用途**: 明示的にポートを指定したい場合（例：開発環境で特定のポート番号を使用したい時）

#### 2. ホストの任意のポートへのマッピング
```
docker container run -p 80 nginx
```
- **意味**: ホストの任意の空きポートをコンテナの80ポートにマッピング
- **用途**: 同じイメージから複数のコンテナを起動する場合やポート番号の衝突を避けたい場合
- **確認方法**: `docker container ls` コマンドで割り当てられたポートを確認

#### 3. 特定のインターフェースでのリッスン
```
docker container run -p 127.0.0.1:8080:80 nginx
```
- **意味**: ローカルホストの8080ポートのみでリッスンし、コンテナの80ポートにマッピング
- **用途**: セキュリティ強化のため、外部からのアクセスを制限したい場合

#### 4. 複数ポートのマッピング
```
docker container run -p 8080:80 -p 8443:443 nginx
```
- **意味**: 複数のポートを同時にマッピング（HTTP用とHTTPS用など）
- **用途**: 複数のサービスや通信プロトコルを提供するコンテナを実行する場合

#### 5. UDPプロトコルの指定
```
docker container run -p 53:53/udp dns-server
```
- **意味**: UDPプロトコルを使用するポートをマッピング
- **用途**: DNSサーバーなどUDPを使用するサービスをコンテナ化する場合

### ポート紐づけのベストプラクティス

1. **必要最小限のポート公開**: セキュリティのため、必要なポートのみを公開する
2. **ポート番号の衝突回避**: 複数コンテナを使用する環境では、ポート番号の衝突に注意する
3. **セキュリティを考慮**: 外部に公開する必要がないサービスは、ローカルインターフェースのみにバインドする

### 関連コマンド
- **ポートマッピングの確認**: `docker container ls` または `docker port [コンテナID/名前]`
- **実行中のコンテナのポート変更**: 基本的には不可能（コンテナの再作成が必要）
